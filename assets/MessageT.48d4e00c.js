import{a as S,Q as E,b as D,c as _}from"./QItemLabel.8c38a0ab.js";import{r as f,G as Z,q as I,at as ee,J as i,T as c,M as o,L as n,al as d,V as U,R as z,N as l,O as u,K as m,Q as h,au as ae,I as g,S as te,ah as se,aj as le,U as oe,ak as ne,am as R}from"./index.6907c00b.js";import{Q as T}from"./QAvatar.3b23fbd4.js";import{Q as ie}from"./QImg.4d80ecd1.js";import{Q as de,f as ue}from"./formatDistance.04543f57.js";import{e as C,d as v,l as ce,q as N,a as O,c as q,o as W,f as V,b as re,u as $}from"./firebase.02bcd041.js";import{g as me,r as fe,u as ve,a as ye}from"./index.esm2017.601a6a60.js";import"./QScrollObserver.f842e0c0.js";var pe="/images/logo.png";const _e={key:0},he=["src"],ge=["src"],ke={class:"text-grey-7"},we=["src"],be=["src"],xe={class:"fayz-icons row justify-between q-mt-sm"},ze={class:"likes-value"},Ce={key:0},Me={key:1},Ae={key:0},De={key:0},qe={class:"q-py-lg q-px-md row items-center q-col-gutter-md"},Fe=["src"],Qe={class:"gapp"},Se={class:"input-file"},Ie=l("span",null,"Add file",-1),Re={class:"col q-pr-md"},Ne={class:"fayz q-py-md"},Ve={class:"text-grey-7"},Le=["src"],Be=["src"],je={class:"fayz-icons row justify-between q-mt-sm"},Ee={class:"likes-value"},Ue={key:0},Te={key:1},Ye={__name:"MessageT",setup(Oe){const a=f(null),L=Z(),B=t=>ue(t,new Date),k=L.currentRoute.value.params;let y=f(""),F=f(!1),w=f(null);const b=f([]);f(!1);let M=f(!0),p=f();const G=me(),j=async t=>{const s=fe(G,`videos/${t.name}`);return await ve(s,t),await ye(s)};setInterval(()=>{localStorage.setItem("lastActiveM",Date.now())},100);const K=async()=>{if(y.value!==""||w.value||p.value){F.value=!1;let t={content:y.value,date:Date.now(),liked:0,image:M.value?"/images/logo.png":"/images/fayz.jpg",images:w.value,video:null,admin:M.value,nickname:M.value?"MuhammadAmin":"Fayzulloh",name:M.value?"@Natsu_Dragnil_END":"@Kenma",MuhammadAmin:!1,Fayzulloh:!1,num:String(k.id)};p.value&&(t.video=await j(p.value));const s=await re(q(v,"fayzstu"),t);console.log("Document written with ID: ",s.id)}else return null;y.value="",w.value=null,p.value=null,F.value=!1},J=t=>{const s=t.target.files[0];if(s){const e=new FileReader;e.onload=async()=>{s.type.startsWith("image")?(p.value=null,w.value=e.result):s.type.startsWith("video")&&(w.value=null,p.value=await j(p.value=t.target.files[0]))},e.readAsDataURL(s)}};I(async()=>{const t=C(v,"fayzs",k.id),s=await ce(t);s.exists()?a.value=s.data():console.log("No such document!"),console.log(a.value)});const P=async()=>{if(a.value){const t=C(v,"fayzs",k.id);await $(t,{liked:a.value.MuhammadAmin?a.value.liked-1:a.value.liked+1,MuhammadAmin:!a.value.MuhammadAmin})}},H=async()=>{a.value&&await V(C(v,"fayzs",k.id))},X=async t=>{(!t.liked||isNaN(t.liked))&&(t.liked=0);const s=t.MuhammadAmin?t.liked-1:t.liked+1,e=C(v,"fayzstu",t.id);await $(e,{liked:s,MuhammadAmin:!t.MuhammadAmin})},Y=async t=>{a.value&&await V(C(v,"fayzstu",t.id))};I(()=>{const t=N(q(v,"fayzs"),O("date"));W(t,s=>{s.docChanges().forEach(async e=>{let r=e.doc.data();r.id=e.doc.id,e.type,e.type==="modified"&&Object.assign(a.value,r),e.type==="removed"&&((await getDocs(N(q(v,"fayzstu"),where("num","==",String(k.id))))).forEach(async x=>{await V(x.ref)}),L.push("/admin"))})})}),I(()=>{const t=N(q(v,"fayzstu"),O("date"));W(t,s=>{s.docChanges().forEach(e=>{let r=e.doc.data();if(r.id=e.doc.id,e.type==="added"&&b.value.unshift(r),e.type==="modified"){let A=b.value.findIndex(x=>x.id===r.id);Object.assign(b.value[A],r)}if(e.type==="removed"){let A=b.value.findIndex(x=>x.id===r.id);b.value.splice(A,1)}})})});let Q=f(!1);return ee(()=>{window.innerWidth<1e3?Q.value=!0:Q.value=!1}),(t,s)=>(i(),c(U,null,[o(S,{to:"/admin",color:"primary",class:"back"},{default:n(()=>[z(" \u2190 ")]),_:1}),a.value?(i(),c("div",_e,[o(E,{separator:""},{default:n(()=>[o(S,{class:"fayz q-py-md"},{default:n(()=>[o(D,{avatar:"",top:""},{default:n(()=>[a.value.image.includes("https")?(i(),c("video",{key:1,onClick:s[1]||(s[1]=(...e)=>t.pushim&&t.pushim(...e)),class:"dodemg",loop:"",autoplay:"",muted:"",src:a.value.image},null,8,ge)):(i(),c("img",{key:0,onClick:s[0]||(s[0]=(...e)=>t.pushim&&t.pushim(...e)),class:"dodemg",src:a.value.image},null,8,he))]),_:1}),o(D,null,{default:n(()=>[o(_,{class:"text-subtitle1 column"},{default:n(()=>[l("strong",null,u(a.value.nickname),1),l("span",ke,u(a.value.name)+" \u2022 "+u(B(a.value.date)),1)]),_:1}),a.value.content?(i(),m(_,{key:0,class:"text-body1 fayz-content"},{default:n(()=>[z(u(a.value.content),1)]),_:1})):d("",!0),a.value.video?(i(),m(_,{key:1,class:"text-body1 maha fayz-content"},{default:n(()=>[l("video",{controls:"",class:"maha",src:a.value.video},null,8,we)]),_:1})):d("",!0),a.value.images?(i(),m(_,{key:2,class:"text-body1 fayz-content"},{default:n(()=>[l("img",{class:"maha",src:a.value.images,alt:""},null,8,be)]),_:1})):d("",!0),l("div",xe,[o(h,{color:"grey",size:"sm",icon:"far fa-comment",flat:"",round:""}),o(h,{color:"grey",size:"sm",icon:"fas fa-retweet",flat:"",round:""}),l("div",ze,[o(h,{color:a.value.liked?"pink":"grey",size:"sm",icon:a.value.liked?"fas fa-heart":"far fa-heart",onClick:P,flat:"",round:""},null,8,["color","icon"]),a.value.liked>1?(i(),c("div",Ce,u(a.value.liked),1)):d("",!0)]),a.value.admin?(i(),m(h,{key:0,onClick:H,color:"grey",size:"sm",icon:"fas fa-trash",flat:"",round:""})):(i(),c("div",Me))])]),_:1})]),_:1}),a.value.MuhammadAmin||a.value.Fayzulloh?(i(),c("div",Ae,[z("liked: "),l("span",null,u(a.value.MuhammadAmin?"MuhammadAmin":""),1),a.value.MuhammadAmin&&a.value.Fayzulloh?(i(),c("span",De,",")):d("",!0),z(),l("span",null,u(a.value.Fayzulloh?"Fayzulloh":""),1)])):d("",!0)]),_:1})])):d("",!0),o(de,{class:"full-height flav absolute"},{default:n(()=>[l("div",qe,[l("div",{class:ae(["col col-5",{"col-10":g(Q)}])},[o(te,{class:"new-fayz",autogrow:"","bottom-slots":"",modelValue:g(y),"onUpdate:modelValue":s[2]||(s[2]=e=>se(y)?y.value=e:y=e),placeholder:"What do you need?",counter:"",maxlength:"280"},{before:n(()=>[o(T,null,{default:n(()=>[l("img",{src:g(pe)},null,8,Fe)]),_:1})]),_:1},8,["modelValue"]),l("div",Qe,[l("label",Se,[l("input",{type:"file",onChange:J,accept:"image/*, video/*"},null,32),Ie])])],2),l("div",Re,[o(h,{onClick:K,class:"q-mr-md",disable:g(F)||!g(y)&&!g(w)&&!g(p),unelevated:"","no-caps":"",rounded:"",color:"primary",label:"Fise"},null,8,["disable"])])]),o(le,{class:"devidor",size:"15px",color:"grey-2"}),o(E,null,{default:n(()=>[(i(!0),c(U,null,oe(b.value,e=>(i(),m(ne,{key:e.id,appear:"","enter-active-class":"animated fadeIn slow","leave-active-class":"animated fadeOut slow"},{default:n(()=>[e.num==String(g(k).id)?(i(),m(S,{key:0},{default:n(()=>[l("div",Ne,[o(D,{avatar:"",top:""},{default:n(()=>[o(T,{size:"xl"},{default:n(()=>[o(ie,{src:e.image},null,8,["src"])]),_:2},1024)]),_:2},1024),o(D,null,{default:n(()=>[o(_,{class:"text-subtitle1 column"},{default:n(()=>[l("strong",null,u(e.nickname),1),l("span",Ve,u(e.name)+" \u2022 "+u(B(e.date)),1)]),_:2},1024),e.content?(i(),m(_,{key:0,class:"text-body1 fayz-content"},{default:n(()=>[z(u(e.content),1)]),_:2},1024)):d("",!0),e.video?(i(),m(_,{key:1,onClick:s[3]||(s[3]=R(()=>{},["prevent"])),class:"text-body1 maha fayz-content"},{default:n(()=>[l("video",{controls:"",class:"maha",src:e.video},null,8,Le)]),_:2},1024)):d("",!0),e.images?(i(),m(_,{key:2,class:"text-body1 fayz-content"},{default:n(()=>[l("img",{class:"maha",src:e.images,alt:""},null,8,Be)]),_:2},1024)):d("",!0),l("div",je,[o(h,{color:"grey",size:"sm",icon:"fas fa-retweet",flat:"",round:""}),l("div",Ee,[o(h,{color:e.liked?"pink":"grey",size:"sm",icon:e.liked?"fas fa-heart":"far fa-heart",onClick:R(r=>X(e),["prevent"]),flat:"",round:""},null,8,["color","icon","onClick"]),e.liked>1?(i(),c("div",Ue,u(e.liked),1)):d("",!0)]),e.admin?(i(),m(h,{key:0,onClick:R(r=>Y(e),["prevent"]),color:"grey",size:"sm",icon:"fas fa-trash",flat:"",round:""},null,8,["onClick"])):(i(),c("div",Te))])]),_:2},1024)])]),_:2},1024)):d("",!0)]),_:2},1024))),128))]),_:1})]),_:1})],64))}};export{Ye as default};
